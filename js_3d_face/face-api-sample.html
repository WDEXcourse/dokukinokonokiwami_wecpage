<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <script src="./lib/face-api.min.js"></script>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <link rel="stylesheet" href="./facecss/face.css">

        <script type="text/javascript">
            function changeColor(){
                var options = document.box.color.options;
                var Idx = document.box.color.selectedIndex;
                console.log(document.box.color.selectedIndex);
                var mytext=options[Idx].text;
                console.log("変わった");
                var selectedIndex=document.box.color.selectedIndex;
                console.log(selectedIndex);

                if(selectedIndex==0){
                    var sample_id = document.getElementById("cover");
                    sample_id.style.backgroundColor = 'aliceblue';  
                    changeFaceLine("rgba(0, 148, 30, 1)");
                    this.lineColor = "rgba(0, 148, 30, 1)";
                    this.pointColor = "rgba(0, 148, 30, 1)";
                }
                if(selectedIndex==1){
                    var sample_id = document.getElementById("cover");
                    // console.log(sample_id);
                    // document.write(cover); // console.log(sample_id);
                    sample_id.style.backgroundColor = '#b9c42f';
                    changeFaceLine("rgba(0, 0, 0, 1)");
                    this.lineColor = "rgba(0, 0, 0, 1)";
                    this.pointColor = "rgba(0, 0, 0, 1)";
                    
                }
                if(selectedIndex==2){
                    var sample_id = document.getElementById("cover");
                    sample_id.style.backgroundColor = 'blue';
                    changeFaceLine("rgba(255, 255, 255, 1)");   
                    this.lineColor = "rgba(0, 0, 0, 1)";
                    this.pointColor = "rgba(0, 0, 0, 1)";
                }
                if(selectedIndex==3){
                    var sample_id = document.getElementById("cover");
                    sample_id.style.backgroundColor = 'red';
                    changeFaceLine("rgba(255, 255, 255, 1)");   
                    this.lineColor =  "rgba(0, 0, 0, 1)";
                    this.pointColor = "rgba(0, 0, 0, 1)";
                }
            }

        </script>
    </head>
    <body>
        <title>顔認識ワイヤーフレーム</title>
        <div class="moji">
            <h1>ワイヤーフレーム</h1>
        </div>
        <style>
            #cover{
                background-color: aliceblue;
                background-image:url(../js_3d_face/images/tomato.jpg); 
                position: absolute;
                top: 0px;
                left: 0px;
                height: 480px;
                width: 640px;
            
                background-repeat:  no-repeat; 
                object-fit: cover; 
            }
        </style>
        <div  style="position: relative">
            <div class="parent">
                <video id="video" onloadedmetadata="onPlay(this)"  style="position :absolute;  top: 0; "muted autoplay width="640" height="480"></video>
                <div id="cover"></div>
                <!-- <img src="../js_3d_face/images/tomato.jpg" width="640" height="480"> -->
                <canvas id="facecanvas" style="position :absolute;  top: 0; " width="640" height="480"></canvas>
                
            </div>
            <h2>フレームが表示されるまで7~8秒かかります。</h2>
            <input type="button" value="カメラ非表示" id="button1"style="background: color #fff;" onmouseover="this.style.background='#99ccff'" onmouseout="this.style.background='#fff'"
            onclick="document.getElementById('cover').style.visibility = 'visible';">
            <input type="button" value="カメラ表示" id="button2"style="background: color #fff;" onmouseover="this.style.background='#99ccff'" onmouseout="this.style.background='#fff'"
            onclick="document.getElementById('cover').style.visibility = 'hidden';">
            
            
            <form name="box">
                <select name="color" id="mySelect" style="top: 500px;position: absolute;left: 750px;height: 25px;width: 70px;"onchange="changeColor()">
                <option value="a">白</option>
                <option value="b">緑</option>
                <option value="c">青</option>
                <option value="d">赤</option>
                <option selected>背景色</option>
                <style>
                    .mySelect{
                        position: absolute;
                        top: 550px;
                        left: 7040px;

                    }
                </style>
            </select>
            </form>
            <style>
                #button1{
                    margin: 100px 0;
                    position: absolute;
                    top: 400px;
                    left: 550px;
                }
                #button2{
                    margin: 100px 0;
                    position: absolute;
                    top: 400px;
                    left: 650px;
                }
            </style>
            <h2>フレームが表示されるまで7~8秒かかります。</h2>
        </div>
        <script>
	const canvas = document.getElementById( 'facecanvas' );
	const videoEl = document.getElementById( 'video' );
	const inputSize = 224;
	const scoreThreshold = 0.5;
	const options = new faceapi.TinyFaceDetectorOptions({ inputSize, scoreThreshold });
	async function onPlay()
	{
            if(videoEl.paused || videoEl.ended || !faceapi.nets.tinyFaceDetector.params)
                return setTimeout(() => onPlay())

            const result = await faceapi.detectSingleFace(videoEl, options).withFaceLandmarks()
            if (result) {
                const dims = faceapi.matchDimensions(canvas, videoEl, true)
                const resizedResult = faceapi.resizeResults(result, dims)
                // faceapi.draw.drawDetections(canvas, resizedResult)//枠
                faceapi.draw.drawFaceLandmarks(canvas, resizedResult)//顔のワイヤーフレーム
            }
            setTimeout(() => onPlay())
  	};
	    
        async function run(){
            await faceapi.nets.tinyFaceDetector.load('/')
            await faceapi.loadFaceLandmarkModel('/')
	    const stream = await navigator.mediaDevices.getUserMedia({ video: {} })
	    videoEl.srcObject = stream;
        }

      	$(document).ready(function() {
            run();
        });
	    
        </script>
    </body>
</html>
<!-- cd js_3d_face/ をして　python3 -m http.server 8000 をした後　http://localhost:8000/face-api-sample.html -->
<!-- face-api.min.jsの31063・31064でワイヤーフレームの色及びモード（線表示・ポイント表示）切り替えが可能 -->