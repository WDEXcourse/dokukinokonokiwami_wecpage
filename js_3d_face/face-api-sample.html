<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <script src="./lib/face-api.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <link rel="stylesheet" href="./facecss/face.css">
    <script type="text/javascript">
        var waku_hyouji = true;
        var face_hyouji = true;

        function changeColor() {
            var options = document.box.color.options;
            var Idx = document.box.color.selectedIndex;
            console.log(document.box.color.selectedIndex);
            var mytext = options[Idx].text;
            console.log("変わった");
            var selectedIndex = document.box.color.selectedIndex;
            console.log(selectedIndex);

            if (selectedIndex == 0) {
                var sample_id = document.getElementById("cover");
                sample_id.style.backgroundColor = 'aliceblue';
                $(function() {
                    $('#gazou img').attr('src', 'images/siro.jpg');
                });
                changeFaceLine("rgba(0, 148, 30, 1)");
                changeBoxColor("rgba(0, 0, 255, 1)");
                this.lineColor = "rgba(0, 148, 30, 1)";
                this.pointColor = "rgba(0, 148, 30, 1)";
            }
            if (selectedIndex == 1) {
                var sample_id = document.getElementById("cover");
                // console.log(sample_id);
                // document.write(cover); // console.log(sample_id);
                sample_id.style.backgroundColor = '#b9c42f';
                $(function() {
                    $('#gazou img').attr('src', 'images/midori.jpg');
                });
                changeFaceLine("rgba(0, 0, 0, 1)");
                changeBoxColor("rgba(0, 0, 255, 1)");
                this.lineColor = "rgba(0, 0, 0, 1)";
                this.pointColor = "rgba(0, 0, 0, 1)";

            }
            if (selectedIndex == 2) {
                var sample_id = document.getElementById("cover");
                sample_id.style.backgroundColor = 'blue';
                $(function() {
                    $('#gazou img').attr('src', 'images/ao.jpg');
                });
                changeFaceLine("rgba(255, 255, 255, 1)");
                changeBoxColor("rgba(255, 0, 0, 1)");
                this.lineColor = "rgba(0, 0, 0, 1)";
                this.pointColor = "rgba(0, 0, 0, 1)";
                this.boxcolor = "rgba(255, 0, 0, 1)";
            }
            if (selectedIndex == 3) {
                var sample_id = document.getElementById("cover");
                sample_id.style.backgroundColor = 'red';
                $(function() {
                    $('#gazou img').attr('src', 'images/aka.jpg');
                });
                changeFaceLine("rgba(255, 255, 255, 1)");
                changeBoxColor("rgba(0, 0, 255, 1)");
                this.lineColor = "rgba(0, 0, 0, 1)";
                this.pointColor = "rgba(0, 0, 0, 1)";
            }
            // ここから下はチェックシート
            if (selectedIndex == 4) { //デザイン
                var sample_id = document.getElementById("gazou");
                $(function() {
                    $('#gazou img').attr('src', 'images/feedback_sheet/nice_design.png');
                });
                changeFaceLine("rgba(0, 0, 0, 1)");
                changeBoxColor("rgba(0, 0, 255, 1)");
                this.lineColor = "rgba(0, 0, 0, 1)";
                this.pointColor = "rgba(0, 0, 0, 1)";
            }
            if (selectedIndex == 5) { //ユーモア
                var sample_id = document.getElementById("gazou");
                $(function() {
                    $('#gazou img').attr('src', 'images/feedback_sheet/nice_humor.png');
                });
                changeFaceLine("rgba(0, 148, 30, 1)");
                changeBoxColor("rgba(0, 0, 255, 1)");
                this.lineColor = "rgba(0, 0, 0, 1)";
                this.pointColor = "rgba(0, 0, 0, 1)";
            }
            if (selectedIndex == 6) { //ストーリー
                var sample_id = document.getElementById("gazou");
                $(function() {
                    $('#gazou img').attr('src', 'images/feedback_sheet/nice_story.png');
                });
                changeFaceLine("rgba(0, 0, 0, 1)");
                changeBoxColor("rgba(0, 0, 255, 1)");
                this.lineColor = "rgba(0, 0, 0, 1)";
                this.pointColor = "rgba(0, 0, 0, 1)";
            }
            if (selectedIndex == 7) { //テクニック
                var sample_id = document.getElementById("gazou");
                $(function() {
                    $('#gazou img').attr('src', 'images/feedback_sheet/nice_techinique.png');
                });
                changeFaceLine("rgba(0, 0, 0, 1)");
                changeBoxColor("rgba(255, 0, 0, 1)");
                this.lineColor = "rgba(0, 0, 0, 1)";
                this.pointColor = "rgba(0, 0, 0, 1)";
            }
        }
    </script>
</head>

<body>
    <title>顔認識ワイヤーフレーム</title>
    <div class="moji">
        <h1>ワイヤーフレーム</h1>
    </div>

    <style>
        #gazou {
            position: absolute;
            top: 0px;
            left: 0px;
            height: 451px;
            width: 640px;
            background-repeat: no-repeat;
            object-fit: cover;
        }
    </style>


    <div style="position: relative">
        <div class="parent">
            <video id="video" onloadedmetadata="onPlay(this)" style="position :absolute;  top: 0; " muted autoplay width="640" height="451"></video>
            <div id="cover"></div>
            <div id="gazou">
                <img src="images/siro.jpg" id="nice">
            </div>

            <!-- <img src="../js_3d_face/images/tomato.jpg" width="640" height="480"> -->
            <canvas id="facecanvas" style="position :absolute;  top: 0; " width="640" height="451"></canvas>

        </div>


        <!-- <input type="button" value="カメラ非表示" id="button1" style="background: color #fff;" onmouseover="this.style.background='#99ccff'" onmouseout="this.style.background='#fff'" onclick="document.getElementById('gazou').style.visibility = 'visible';">
        <input type="button" value="カメラ表示" id="button2" style="background: color #fff;" onmouseover="this.style.background='#99ccff'" onmouseout="this.style.background='#fff'" onclick="document.getElementById('gazou').style.visibility = 'hidden';"> -->

        <form name="box">
            <select name="color" id="mySelect" style="top: 500px;position: absolute;left: 600px;height: 25px;width: 90px;" onchange="changeColor()">
                <option value="a">白</option>
                <option value="b">緑</option>
                <option value="c">青</option>
                <option value="d">赤</option>
                <option value="e">デザイン</option>
                <option value="f">ユーモア</option>
                <option value="g">ストーリー</option>
                <option value="h">テクニック</option>
                <option selected>背景色</option>

                <style>
                    .mySelect{
                        position: absolute;
                        top: 550px;
                        left: 640px;
                    }
                </style>
            </select>
        </form>

        <style>
            #label_camera {
                margin: 100px 0;
                position: absolute;
                top: 400px;
                left: 400px;
            }
            
            #label_waku {
                margin: 100px 0;
                position: absolute;
                top: 400px;
                left: 460px;
            }
            
            #label_face {
                margin: 100px 0;
                position: absolute;
                top: 400px;
                left: 520px;
            }
        </style>
        <h2>フレームが表示されるまで7〜8秒、<br>スイッチをON/OFFしたら変更が反映されるまで最大1〜2秒かかります。</h2>


        <div>
            <label class="switch__label" id="label_camera">
                
                <input type="checkbox" class="switch__input" value="Click" id="check_camera" onclick="camera()">
                <span class="switch__content"></span>
                <span class="switch__circle"></span>
                <div id="camera_hyouji" style="color: red;text-align: center;position: absolute;top: -70px;left: 0px;">
                    <h5>カメラ ON/OFF</h5>
                </div>
                
                
            </label>
            <script>
                function camera() {
                    console.log("1");
                    if (document.getElementById('check_camera').checked) {
                        console.log("2")
                        $("#gazou").hide();
                    } else {
                        console.log("3")
                        $("#gazou").show();
                    }
                }
            </script>
            <label class="switch__label" id="label_waku">
                <input type="checkbox" class="switch__input" value="Click" id="check_waku" onclick="waku()">
                <span class="switch__content"></span>
                <span class="switch__circle"></span>
                <div id="camera_hyouji" style="color: red;text-align: center;position: absolute;top: -70px;left: 0px;">
                    <h5>枠ON/OFF</h5>
                </div>
                
                
            </label>
            <script>
                function waku() {
                    console.log("4");
                    if (document.getElementById('check_waku').checked) {
                        console.log("5")
                        waku_hyouji = false;
                    } else {
                        console.log("6")
                        waku_hyouji = true;
                    }
                }
            </script>
            <label class="switch__label" id="label_face">
                <input type="checkbox" class="switch__input" value="Click" id="check_face" onclick="face()">
                <span class="switch__content"></span>
                <span class="switch__circle"></span>
                <div id="camera_hyouji" style="color: red;text-align: center;position: absolute;top: -70px;left: 0px;">
                    <h5>モデルON/OFF</h5>
                </div>
                
            </label>
            <script>
                function face() {
                    console.log("7");
                    if (document.getElementById('check_face').checked) {
                        console.log("8")
                        face_hyouji = false;
                    } else {
                        console.log("9")
                        face_hyouji = true;
                    }
                }
            </script>

        </div>
    </div>

    <script>
        const canvas = document.getElementById('facecanvas');
        const videoEl = document.getElementById('video');
        const inputSize = 224;
        const scoreThreshold = 0.5;
        const options = new faceapi.TinyFaceDetectorOptions({
            inputSize,
            scoreThreshold
        });
        async function onPlay() {
            if (videoEl.paused || videoEl.ended || !faceapi.nets.tinyFaceDetector.params)
                return setTimeout(() => onPlay())
            const result = await faceapi.detectSingleFace(videoEl, options).withFaceLandmarks()
            if (result) {
                const dims = faceapi.matchDimensions(canvas, videoEl, true)
                const resizedResult = faceapi.resizeResults(result, dims)
                if (waku_hyouji) {
                    faceapi.draw.drawDetections(canvas, resizedResult) //枠
                }
                if (face_hyouji) {
                    faceapi.draw.drawFaceLandmarks(canvas, resizedResult) //顔のワイヤーフレーム
                }

            }
            setTimeout(() => onPlay())
        };

        async function run() {
            await faceapi.nets.tinyFaceDetector.load('/')
            await faceapi.loadFaceLandmarkModel('/')
            const stream = await navigator.mediaDevices.getUserMedia({
                video: {}
            })
            videoEl.srcObject = stream;
        }

        $(document).ready(function() {
            run();
        });
    </script>
</body>

</html>
<!-- cd js_3d_face/ をして　python3 -m http.server 8000 をした後　http://localhost:8000/face-api-sample.html -->
<!-- face-api.min.jsの31063・31064でワイヤーフレームの色及びモード（線表示・ポイント表示）切り替えが可能 -->
<!-- heroku メール kamotan.kamotan3@gmail.com パス Kamotan@1012 -->